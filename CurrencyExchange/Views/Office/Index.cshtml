@using CurrencyExchange.ViewModels;
@using CurrencyExchange.Enums;
@model OfficeVM

@{
    ViewData["Title"] = "Личный кабинет";
}

<div class="container mt-5">
    <div class="text-center mb-4">
        <h1>@Model.User?.Name</h1>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <ul class="nav nav-tabs" id="officeTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active tabs" id="personal-data-tab" data-bs-toggle="tab" data-bs-target="#personal-data" type="button" role="tab" aria-controls="personal-data" aria-selected="true">Личные данные</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link tabs" id="exchange-history-tab" data-bs-toggle="tab" data-bs-target="#exchange-history" type="button" role="tab" aria-controls="exchange-history" aria-selected="false">История обмена валют</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link tabs" id="transfer-history-tab" data-bs-toggle="tab" data-bs-target="#transfer-history" type="button" role="tab" aria-controls="transfer-history" aria-selected="false">История международных переводов</button>
                </li>
            </ul>

            <div class="tab-content mt-3">
                <div class="tab-pane fade show active" id="personal-data" role="tabpanel" aria-labelledby="personal-data-tab">
                    <div class="card">
                        <div class="card-body">
                            <p><strong>Имя и фамилия:</strong> @Model.User?.Name</p>
                            <p><strong>Email:</strong> @Model.User?.Email</p>
                            <p><strong>Телефон:</strong> @Model.User?.PhoneNumber</p>
                            <p><strong>Адрес:</strong> @Model.User?.Address</p>
                            <a class="btn btn-primary" href="@Url.Action("Edit")">Редактировать</a>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="exchange-history" role="tabpanel" aria-labelledby="exchange-history-tab">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="thead-light">
                                <tr>
                                    <th>Сумма</th>
                                    <th>Валюта от</th>
                                    <th>Полученная Сумма</th>
                                    <th>Валюта к</th>
                                    <th>Дата создания</th>
                                    <th>Статус</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var application in Model.Applications!)
                                {
                                    <tr tr class="tr-tbody">
                                        <td>@application.Amount</td>
                                        <td>@application.CurrencyFrom</td>
                                        <td>@application.AmountDue</td>
                                        <td>@application.CurrencyTo</td>
                                        <td>@application.CreatedAt.ToString()</td>
                                        <td>
                                            @if (application.Status == ApplicationStatus.Approved.ToString())
                                            {
                                                <span class="text-success">✔</span>
                                            }
                                            else if (application.Status == ApplicationStatus.Rejected.ToString())
                                            {
                                                <span class="text-danger">❌</span>
                                            }
                                            else if (application.Status == ApplicationStatus.Pending.ToString())
                                            {
                                                <span class="text-info">🕐</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-pane fade" id="transfer-history" role="tabpanel" aria-labelledby="transfer-history-tab">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="thead-light">
                                <tr>
                                    <th>Сумма</th>
                                    <th>Валюта</th>
                                    <th>Имя получателя</th>
                                    <th>Счет получателя</th>
                                    <th>Адрес получателя</th>
                                    <th>Дата создания</th>
                                    <th>Статус</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var transfer in Model.TransferRequests!)
                                {
                                    <tr class="tr-tbody">
                                        <td>@transfer.Amount</td>
                                        <td>@transfer.Currency</td>
                                        <td>@transfer.RecipientName</td>
                                        <td>@transfer.RecipientAccount</td>
                                        <td>@transfer.RecipientAddress</td>
                                        <td>@transfer.CreatedAt.ToString()</td>
                                        <td>
                                            @if (transfer.Status == TransferStatus.Completed.ToString())
                                            {
                                                <span class="text-success">✔</span>
                                            }
                                            else if (transfer.Status == TransferStatus.Canceled.ToString())
                                            {
                                                <span class="text-danger">❌</span>
                                            }
                                            else if (transfer.Status == TransferStatus.Pending.ToString())
                                            {
                                                <span class="text-info">🕐</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var triggerTabList = [].slice.call(document.querySelectorAll('#officeTabs button'))
            triggerTabList.forEach(function (triggerEl) {
                var tabTrigger = new bootstrap.Tab(triggerEl)

                triggerEl.addEventListener('click', function (event) {
                    event.preventDefault()
                    tabTrigger.show()
                })
            })
        });
    </script>
}

@section css {
    <link rel="stylesheet" href="~/css/office.css" asp-append-version="true" />
}
